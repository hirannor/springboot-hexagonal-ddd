<svg viewBox="0 0 1400 900" xmlns="http://www.w3.org/2000/svg">
    <defs>
        <!-- Enhanced arrow marker -->
        <marker id="arrowhead" markerWidth="12" markerHeight="10"
                refX="12" refY="5" orient="auto" markerUnits="strokeWidth">
            <path d="M 0,0 L 12,5 L 0,10 L 3,5 Z" fill="#2D3748" stroke="#2D3748" stroke-width="1"/>
        </marker>

        <!-- Drop shadow filter -->
        <filter id="dropShadow" x="-20%" y="-20%" width="140%" height="140%">
            <feDropShadow dx="2" dy="2" stdDeviation="3" flood-opacity="0.3"/>
        </filter>

        <!-- Gradients for different state types -->
        <linearGradient id="startGradient" x1="0%" y1="0%" x2="100%" y2="100%">
            <stop offset="0%" style="stop-color:#68D391"/>
            <stop offset="100%" style="stop-color:#38A169"/>
        </linearGradient>

        <linearGradient id="paymentGradient" x1="0%" y1="0%" x2="100%" y2="100%">
            <stop offset="0%" style="stop-color:#F6E05E"/>
            <stop offset="100%" style="stop-color:#D69E2E"/>
        </linearGradient>

        <linearGradient id="processGradient" x1="0%" y1="0%" x2="100%" y2="100%">
            <stop offset="0%" style="stop-color:#90CDF4"/>
            <stop offset="100%" style="stop-color:#2B6CB0"/>
        </linearGradient>

        <linearGradient id="failureGradient" x1="0%" y1="0%" x2="100%" y2="100%">
            <stop offset="0%" style="stop-color:#FC8181"/>
            <stop offset="100%" style="stop-color:#C53030"/>
        </linearGradient>

        <linearGradient id="terminalGradient" x1="0%" y1="0%" x2="100%" y2="100%">
            <stop offset="0%" style="stop-color:#A0AEC0"/>
            <stop offset="100%" style="stop-color:#4A5568"/>
        </linearGradient>
    </defs>

    <!-- Background -->
    <rect width="1400" height="900" fill="#F8FAFC"/>

    <!-- Title -->
    <text x="700" y="40" text-anchor="middle" font-family="Arial, sans-serif"
          font-size="28" font-weight="bold" fill="#1A202C">
        Order Status Transition Diagram
    </text>

    <!-- Main flow line (visual guide) -->
    <line x1="150" y1="150" x2="1250" y2="150" stroke="#E2E8F0" stroke-width="2" stroke-dasharray="5,5"/>

    <!-- States with better positioning -->

    <!-- Row 1: Main happy path -->
    <!-- WAITING_FOR_PAYMENT -->
    <g transform="translate(150,150)">
        <ellipse cx="0" cy="0" rx="80" ry="40" fill="url(#startGradient)"
                 stroke="#38A169" stroke-width="2" filter="url(#dropShadow)"/>
        <text x="0" y="-8" text-anchor="middle" font-family="Arial, sans-serif"
              font-size="11" font-weight="bold" fill="#1A365D">WAITING FOR
        </text>
        <text x="0" y="8" text-anchor="middle" font-family="Arial, sans-serif"
              font-size="11" font-weight="bold" fill="#1A365D">PAYMENT
        </text>
    </g>

    <!-- PAID_SUCCESSFULLY -->
    <g transform="translate(350,150)">
        <ellipse cx="0" cy="0" rx="75" ry="35" fill="url(#paymentGradient)"
                 stroke="#D69E2E" stroke-width="2" filter="url(#dropShadow)"/>
        <text x="0" y="-6" text-anchor="middle" font-family="Arial, sans-serif"
              font-size="12" font-weight="bold" fill="#1A365D">PAID
        </text>
        <text x="0" y="8" text-anchor="middle" font-family="Arial, sans-serif"
              font-size="12" font-weight="bold" fill="#1A365D">SUCCESSFULLY
        </text>
    </g>

    <!-- PROCESSING -->
    <g transform="translate(550,150)">
        <ellipse cx="0" cy="0" rx="70" ry="35" fill="url(#processGradient)"
                 stroke="#2B6CB0" stroke-width="2" filter="url(#dropShadow)"/>
        <text x="0" y="2" text-anchor="middle" font-family="Arial, sans-serif"
              font-size="13" font-weight="bold" fill="white">PROCESSING
        </text>
    </g>

    <!-- SHIPPED -->
    <g transform="translate(750,150)">
        <ellipse cx="0" cy="0" rx="60" ry="35" fill="url(#processGradient)"
                 stroke="#2B6CB0" stroke-width="2" filter="url(#dropShadow)"/>
        <text x="0" y="2" text-anchor="middle" font-family="Arial, sans-serif"
              font-size="13" font-weight="bold" fill="white">SHIPPED
        </text>
    </g>

    <!-- DELIVERED -->
    <g transform="translate(950,150)">
        <ellipse cx="0" cy="0" rx="65" ry="35" fill="url(#processGradient)"
                 stroke="#2B6CB0" stroke-width="2" filter="url(#dropShadow)"/>
        <text x="0" y="2" text-anchor="middle" font-family="Arial, sans-serif"
              font-size="13" font-weight="bold" fill="white">DELIVERED
        </text>
    </g>

    <!-- Row 2: Payment failure states -->
    <!-- PAYMENT_FAILED -->
    <g transform="translate(150,300)">
        <ellipse cx="0" cy="0" rx="70" ry="35" fill="url(#failureGradient)"
                 stroke="#C53030" stroke-width="2" filter="url(#dropShadow)"/>
        <text x="0" y="-6" text-anchor="middle" font-family="Arial, sans-serif"
              font-size="12" font-weight="bold" fill="white">PAYMENT
        </text>
        <text x="0" y="8" text-anchor="middle" font-family="Arial, sans-serif"
              font-size="12" font-weight="bold" fill="white">FAILED
        </text>
    </g>

    <!-- PAYMENT_CANCELED -->
    <g transform="translate(350,300)">
        <ellipse cx="0" cy="0" rx="75" ry="35" fill="url(#failureGradient)"
                 stroke="#C53030" stroke-width="2" filter="url(#dropShadow)"/>
        <text x="0" y="-6" text-anchor="middle" font-family="Arial, sans-serif"
              font-size="12" font-weight="bold" fill="white">PAYMENT
        </text>
        <text x="0" y="8" text-anchor="middle" font-family="Arial, sans-serif"
              font-size="12" font-weight="bold" fill="white">CANCELED
        </text>
    </g>

    <!-- Row 3: Other states -->
    <!-- CANCELLED -->
    <g transform="translate(550,400)">
        <ellipse cx="0" cy="0" rx="65" ry="35" fill="url(#failureGradient)"
                 stroke="#C53030" stroke-width="2" filter="url(#dropShadow)"/>
        <text x="0" y="2" text-anchor="middle" font-family="Arial, sans-serif"
              font-size="13" font-weight="bold" fill="white">CANCELLED
        </text>
    </g>

    <!-- RETURNED -->
    <g transform="translate(950,300)">
        <ellipse cx="0" cy="0" rx="65" ry="35" fill="url(#failureGradient)"
                 stroke="#C53030" stroke-width="2" filter="url(#dropShadow)"/>
        <text x="0" y="2" text-anchor="middle" font-family="Arial, sans-serif"
              font-size="13" font-weight="bold" fill="white">RETURNED
        </text>
    </g>

    <!-- REFUNDED (Terminal) -->
    <g transform="translate(750,500)">
        <ellipse cx="0" cy="0" rx="65" ry="35" fill="url(#terminalGradient)"
                 stroke="#2D3748" stroke-width="3" filter="url(#dropShadow)"/>
        <text x="0" y="2" text-anchor="middle" font-family="Arial, sans-serif"
              font-size="13" font-weight="bold" fill="white">REFUNDED
        </text>
    </g>

    <!-- Smooth curved transitions -->

    <!-- Happy path arrows -->
    <path d="M 230 150 Q 290 130 290 150" stroke="#2D3748" stroke-width="2.5"
          fill="none" marker-end="url(#arrowhead)"/>
    <path d="M 425 150 Q 485 130 485 150" stroke="#2D3748" stroke-width="2.5"
          fill="none" marker-end="url(#arrowhead)"/>
    <path d="M 620 150 Q 680 130 680 150" stroke="#2D3748" stroke-width="2.5"
          fill="none" marker-end="url(#arrowhead)"/>
    <path d="M 810 150 Q 870 130 885 150" stroke="#2D3748" stroke-width="2.5"
          fill="none" marker-end="url(#arrowhead)"/>

    <!-- From WAITING_FOR_PAYMENT to failures -->
    <path d="M 150 190 Q 140 245 150 265" stroke="#E53E3E" stroke-width="2"
          fill="none" marker-end="url(#arrowhead)"/>
    <path d="M 180 185 Q 250 220 320 265" stroke="#E53E3E" stroke-width="2"
          fill="none" marker-end="url(#arrowhead)"/>
    <path d="M 200 180 Q 350 280 485 365" stroke="#E53E3E" stroke-width="2"
          fill="none" marker-end="url(#arrowhead)"/>

    <!-- From payment failures back to waiting -->
    <path d="M 150 265 Q 140 220 150 190" stroke="#4299E1" stroke-width="2"
          fill="none" marker-end="url(#arrowhead)"/>
    <path d="M 320 280 Q 250 240 180 185" stroke="#4299E1" stroke-width="2"
          fill="none" marker-end="url(#arrowhead)"/>

    <!-- From payment failures to paid (retry success) -->
    <path d="M 220 285 Q 280 220 320 175" stroke="#38A169" stroke-width="2"
          fill="none" marker-end="url(#arrowhead)"/>
    <path d="M 380 280 Q 370 220 360 185" stroke="#38A169" stroke-width="2"
          fill="none" marker-end="url(#arrowhead)"/>

    <!-- From payment failures to cancelled -->
    <path d="M 200 325 Q 350 380 485 385" stroke="#E53E3E" stroke-width="2"
          fill="none" marker-end="url(#arrowhead)"/>
    <path d="M 400 325 Q 470 370 485 385" stroke="#E53E3E" stroke-width="2"
          fill="none" marker-end="url(#arrowhead)"/>

    <!-- From PAID_SUCCESSFULLY to CANCELLED and REFUNDED -->
    <path d="M 380 180 Q 450 290 485 365" stroke="#E53E3E" stroke-width="2"
          fill="none" marker-end="url(#arrowhead)"/>
    <path d="M 400 175 Q 550 330 685 475" stroke="#4A5568" stroke-width="2"
          fill="none" marker-end="url(#arrowhead)"/>

    <!-- From PROCESSING to CANCELLED -->
    <path d="M 550 185 Q 550 290 550 365" stroke="#E53E3E" stroke-width="2"
          fill="none" marker-end="url(#arrowhead)"/>

    <!-- From DELIVERED to RETURNED -->
    <path d="M 950 185 Q 950 240 950 265" stroke="#E53E3E" stroke-width="2"
          fill="none" marker-end="url(#arrowhead)"/>

    <!-- From SHIPPED to RETURNED -->
    <path d="M 800 165 Q 870 200 885 280" stroke="#E53E3E" stroke-width="2"
          fill="none" marker-end="url(#arrowhead)"/>

    <!-- From CANCELLED to REFUNDED -->
    <path d="M 580 425 Q 650 460 685 485" stroke="#4A5568" stroke-width="2"
          fill="none" marker-end="url(#arrowhead)"/>

    <!-- From RETURNED to REFUNDED -->
    <path d="M 920 325 Q 850 410 815 480" stroke="#4A5568" stroke-width="2"
          fill="none" marker-end="url(#arrowhead)"/>

    <!-- Enhanced Legend -->
    <g transform="translate(50, 600)">
        <rect x="-20" y="-20" width="320" height="280" rx="10" fill="white"
              stroke="#E2E8F0" stroke-width="1" filter="url(#dropShadow)"/>

        <text x="10" y="10" font-family="Arial, sans-serif" font-size="18"
              font-weight="bold" fill="#2D3748">Legend
        </text>

        <g transform="translate(20, 40)">
            <ellipse cx="0" cy="0" rx="15" ry="10" fill="url(#startGradient)"
                     stroke="#38A169" stroke-width="1"/>
            <text x="25" y="5" font-family="Arial, sans-serif" font-size="13" fill="#2D3748">
                Initial State
            </text>
        </g>

        <g transform="translate(20, 70)">
            <ellipse cx="0" cy="0" rx="15" ry="10" fill="url(#paymentGradient)"
                     stroke="#D69E2E" stroke-width="1"/>
            <text x="25" y="5" font-family="Arial, sans-serif" font-size="13" fill="#2D3748">
                Payment Success
            </text>
        </g>

        <g transform="translate(20, 100)">
            <ellipse cx="0" cy="0" rx="15" ry="10" fill="url(#processGradient)"
                     stroke="#2B6CB0" stroke-width="1"/>
            <text x="25" y="5" font-family="Arial, sans-serif" font-size="13" fill="#2D3748">
                Fulfillment States
            </text>
        </g>

        <g transform="translate(20, 130)">
            <ellipse cx="0" cy="0" rx="15" ry="10" fill="url(#failureGradient)"
                     stroke="#C53030" stroke-width="1"/>
            <text x="25" y="5" font-family="Arial, sans-serif" font-size="13" fill="#2D3748">
                Failure/Cancel States
            </text>
        </g>

        <g transform="translate(20, 160)">
            <ellipse cx="0" cy="0" rx="15" ry="10" fill="url(#terminalGradient)"
                     stroke="#2D3748" stroke-width="2"/>
            <text x="25" y="5" font-family="Arial, sans-serif" font-size="13" fill="#2D3748">
                Terminal State
            </text>
        </g>

        <g transform="translate(20, 200)">
            <path d="M 0 0 Q 15 -5 30 0" stroke="#2D3748" stroke-width="2.5"
                  fill="none" marker-end="url(#arrowhead)"/>
            <text x="40" y="5" font-family="Arial, sans-serif" font-size="13" fill="#2D3748">
                Normal Flow
            </text>
        </g>

        <g transform="translate(20, 230)">
            <path d="M 0 0 Q 15 -5 30 0" stroke="#E53E3E" stroke-width="2"
                  fill="none" marker-end="url(#arrowhead)"/>
            <text x="40" y="5" font-family="Arial, sans-serif" font-size="13" fill="#2D3748">
                Error/Cancel Flow
            </text>
        </g>
    </g>

    <!-- Flow Notes -->
    <g transform="translate(450, 650)">
        <rect x="-20" y="-20" width="500" height="220" rx="10" fill="white"
              stroke="#E2E8F0" stroke-width="1" filter="url(#dropShadow)"/>

        <text x="10" y="10" font-family="Arial, sans-serif" font-size="18"
              font-weight="bold" fill="#2D3748">Key Transitions
        </text>

        <text x="20" y="40" font-family="Arial, sans-serif" font-size="13" fill="#4A5568">
            • Payment failures can retry (back to WAITING_FOR_PAYMENT)
        </text>
        <text x="20" y="60" font-family="Arial, sans-serif" font-size="13" fill="#4A5568">
            • Payment failures can also succeed directly (to PAID_SUCCESSFULLY)
        </text>
        <text x="20" y="80" font-family="Arial, sans-serif" font-size="13" fill="#4A5568">
            • Orders can be CANCELLED from most active states
        </text>
        <text x="20" y="100" font-family="Arial, sans-serif" font-size="13" fill="#4A5568">
            • SHIPPED and DELIVERED orders can be RETURNED
        </text>
        <text x="20" y="120" font-family="Arial, sans-serif" font-size="13" fill="#4A5568">
            • CANCELLED and RETURNED orders lead to REFUNDED
        </text>
        <text x="20" y="140" font-family="Arial, sans-serif" font-size="13" fill="#4A5568">
            • REFUNDED is terminal (no outgoing transitions)
        </text>
        <text x="20" y="170" font-family="Arial, sans-serif" font-size="13" fill="#4A5568">
            • PAID_SUCCESSFULLY can go directly to REFUNDED (immediate refund)
        </text>
    </g>
</svg>